import{NumberFn,FetchFn}from"./scripts/lib.js";import{DomFn}from"./scripts/client.js";import{errorLog}from"./scripts/base.js";let numFn=new NumberFn,fetchFn=new FetchFn,domFn=new DomFn,url=new URL(location.href,location.origin),params=url.searchParams,canvas=domFn.select("canvas"),context=canvas.getContext("2d"),form=domFn.select("form"),center=[0,0],lineWidth=10,depth=parseInt(params.get("layers")??5),branches=parseInt(params.get("branches")??3),size=parseInt(params.get("size")??200),baseAngle=parseInt(params.get("base-angle")??-90),startTime,speed=parseInt(params.get("speed")??1),direction="true"===params.get("direction");function init(){var e=domFn.select('input[name="layers"]'),t=domFn.select('input[name="branches"]'),n=domFn.select('input[name="size"]'),a=domFn.select('input[name="base-angle"]'),r=domFn.select('input[name="speed"]'),s=domFn.select('input[name="direction"]');e.value=depth,t.value=branches,n.value=size,a.value=baseAngle,r.value=speed,s.checked=direction,context.translate(canvas.width/2,canvas.height/2)}function fractale(n,a,r,s,c){if(0!==c){var i=360/a,o=[];let t=baseAngle;context.beginPath();for(let e=0;e<a;e++){var l=numFn.destPosition(n,t,r);context.lineWidth=s,context.strokeStyle=`hsl(${baseAngle}, 100%, 50%)`,context.moveTo(n[0],n[1]),context.lineTo(l[0],l[1]),o.push(l),t+=i}context.stroke(),context.closePath(),t=baseAngle,r/=2,s/=2,c--,o.forEach(e=>fractale(e,a,r,s,c))}}function loop(e){try{var t;return startTime?e<startTime+40||(startTime=e,t=Math.max(canvas.width,canvas.height),context.clearRect(center[0]-t/2-10,center[1]-t/2-10,t+20,t+20),branches=numFn.clamp(branches,1,20),size=numFn.clamp(size,50,1e3),depth=numFn.clamp(depth,1,10),fractale(center,branches,size,lineWidth,depth),speed=numFn.clamp(speed,0,30),baseAngle+=.3*speed*(direction?1:-1)):startTime=e,requestAnimationFrame(loop)}catch(e){return errorLog(e)}}function listener(e){try{e.preventDefault();var t=new FormData(form),n=(depth=parseInt(t.get("layers")),branches=parseInt(t.get("branches")),size=parseInt(t.get("size")),baseAngle=parseInt(t.get("base-angle")),speed=parseInt(t.get("speed")),direction=!!t.get("direction"),{layers:depth,branches:branches,size:size,"base-angle":baseAngle,speed:speed,direction:direction});history.replaceState(null,null,fetchFn.objToHttpReq(n))}catch(e){return errorLog(e)}}init(),loop(),form.addEventListener("submit",listener);