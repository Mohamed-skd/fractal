import{error}from"./scripts/base.js";import{NumberFuncs,DomFuncs,FetchFuncs}from"./scripts/client.js";import{Copyright,Canvas,Share,ThemeSetter}from"./scripts/lib.js";let numFn=new NumberFuncs,domFn=new DomFuncs,fetchFn=new FetchFuncs,url=(new Copyright,new ThemeSetter,new Share,new URL(location.href,location.origin)),params=url.searchParams,domCvs=domFn.select("canvas"),form=domFn.select("form"),canvas=new Canvas(domCvs),center=[0,0],depth=parseInt(params.get("layers")??5),branches=parseInt(params.get("branches")??5),size=parseInt(params.get("size")??100),baseAngle=parseInt(params.get("base-angle")??0),startTime,speed=parseInt(params.get("speed")??0),direction="true"===params.get("direction");function init(){var e=domFn.select('input[name="layers"]'),n=domFn.select('input[name="branches"]'),t=domFn.select('input[name="size"]'),a=domFn.select('input[name="base-angle"]'),r=domFn.select('input[name="speed"]'),s=domFn.select('input[name="direction"]');e.value=depth,n.value=branches,t.value=size,a.value=baseAngle,r.value=speed,s.checked=direction}function fractale(t,a,r,s,i){if(0!==i){var c=360/a,o=[];let n=baseAngle;for(let e=0;e<a;e++)canvas.ctxt.lineWidth=s,o.push(canvas.line(t,n,r,[baseAngle,100,50])),n+=c;n=baseAngle,r/=2,s/=2,i--,o.forEach(e=>fractale(e,a,r,s,i))}}function loop(e){try{return startTime?e<startTime+20||(startTime=e,canvas.clear(),size=numFn.clamp(size,0,1/0),fractale(center,branches,size,2,depth),speed=numFn.clamp(speed,0,1/0),baseAngle+=direction?.5*speed:.5*speed*-1):startTime=e,requestAnimationFrame(loop)}catch(e){return error(e)}}function listener(e){try{e.preventDefault();var n=new FormData(form),t=(depth=parseInt(n.get("layers")),branches=parseInt(n.get("branches")),size=parseInt(n.get("size")),baseAngle=parseInt(n.get("base-angle")),speed=parseInt(n.get("speed")),direction=!!n.get("direction"),{layers:depth,branches:branches,size:size,"base-angle":baseAngle,speed:speed,direction:direction});history.replaceState(null,null,"?"+fetchFn.objToReq(t))}catch(e){return error(e)}}try{init(),loop(),form.addEventListener("submit",listener)}catch(e){error(e)}