import{NumberFuncs,DomFuncs,FetchFuncs}from"./client.js";import{error}from"./base.js";let numFn=new NumberFuncs,domFn=new DomFuncs,fetchFn=new FetchFuncs;class Notification{constructor(e,s,r=2){try{var i=domFn.select("#notifications");if(!domFn.isElem(i))throw new Error(`Invalid DOM root: ${i}.`);let t=domFn.create("p");this.content=e,this.type=s,this.delay=r,this.type&&domFn.modClass(t,this.type),t.textContent=this.content,i.append(t),setTimeout(()=>{t.remove()},1e3*this.delay)}catch(t){error(t)}}}class ThemeSetter{static isSet=!1;constructor(e=null){try{if(ThemeSetter.isSet)throw new Error("Already Set.");ThemeSetter.isSet=!0;var s=domFn.select("#theme");if(!domFn.isElem(s))throw new Error(`Invalid DOM root: ${s}.`);let t=matchMedia("(prefers-color-scheme:dark)");var r=domFn.create("button",{title:"THEME"});this.elems=e,this.histTheme=fetchFn.local("dark-theme"),this.darkTheme=this.histTheme.get()??t.matches,this.setTheme(),s.append(r),r.addEventListener("click",this.togTheme.bind(this)),t.addEventListener("change",()=>{this.darkTheme=t.matches,this.setTheme()})}catch(t){error(t)}}setTheme(){if(this.darkTheme){if(document.documentElement.style.colorScheme="dark",this.elems?.length)for(let t=0;t<this.elems.length;t++)domFn.modClass(this.elems[t],"dark")}else if(document.documentElement.style.colorScheme="light",this.elems?.length)for(let t=0;t<this.elems.length;t++)domFn.modClass(this.elems[t],"dark","del");this.histTheme.set(this.darkTheme)}togTheme(){this.darkTheme=!this.darkTheme,this.setTheme()}}class SectionsSetter{static isSet=!1;constructor(){try{if(SectionsSetter.isSet)throw new Error("Already set.");SectionsSetter.isSet=!0;var e=domFn.select("#nav-page");let t;e&&(t=domFn.create("ul",{class:"flex"}),e.append(t));var s,r,i,o,n,h,c=domFn.selectAll("main > section");if(!c.length)throw new Error(`No sections: ${c}.`);for(s of c)domFn.isElem(s)&&(r=s.id.trim())&&(i=r[0].toUpperCase()+r.replace("-"," ").slice(1),(o=domFn.create("h2")).textContent=i,s.prepend(o),domFn.isElem(t))&&(n=domFn.create("li"),(h=domFn.create("a",{class:"link",href:"#"+r,target:"_self"})).textContent=i,n.append(h),t.append(n))}catch(t){error(t)}}}class Copyright{static isSet=!1;constructor(t="Par ",e={ref:"https://moh-sd.free.nf/",content:"Moh. SD"},s){try{if(Copyright.isSet)throw new Error("Already set.");Copyright.isSet=!0;var r=domFn.select("#copyright");if(!domFn.isElem(r))throw new Error(`Invalid DOM root: ${r}.`);var i,o=new Date;this.content=t,this.link=e,r.textContent="",this.content||this.link?this.link?((i=domFn.create("a",{href:this.link.ref,class:"link"})).textContent=this.link.content,r.append(this.content,i,` © ${s?s+" -":""} `+o.getFullYear())):r.append(this.content,` © ${s?s+" -":""} `+o.getFullYear()):r.textContent=`© ${s?s+" -":""} `+o.getFullYear()}catch(t){error(t)}}}class TopButton{static isSet=!1;constructor(){try{if(TopButton.isSet)throw new Error("Already set.");TopButton.isSet=!0;var t=domFn.select("#to-top");if(!domFn.isElem(t))throw new Error(`Invalid DOM root: ${t}.`);t.addEventListener("click",()=>scroll(0,0))}catch(t){error(t)}}}class Canvas{constructor(t){try{if(!(t instanceof HTMLCanvasElement))throw new Error(`Invalid canvas element: ${t}.`);this.canvas=t,this.ctxt=t.getContext("2d"),this.ctxt.translate(this.canvas.width/2,this.canvas.height/2)}catch(t){error(t)}}clear(t=[0,0],e=Math.max(this.canvas.width,this.canvas.height)){this.ctxt.clearRect(t[0]-e/2-10,t[1]-e/2-10,e+20,e+20)}getColor(t,e,s,r=1){return`hsl(${t}, ${e}%, ${s}%, ${r=numFn.clamp(r,0,1)})`}getLinearGradient(t,e,s,r){var e=numFn.destPosition(t,e,s),i=this.ctxt.createLinearGradient(t[0],t[1],e[0],e[1]);for(let t=0;t<r.length;t++)i.addColorStop(r[t].offset,this.getColor(...r[t].color));return i}line(t=[0,0],e=0,s=50,r=[0,0,0]){var[e,s]=numFn.destPosition(t,e,s);return this.ctxt.strokeStyle=this.getColor(...r),this.ctxt.beginPath(),this.ctxt.moveTo(t[0],t[1]),this.ctxt.lineTo(e,s),this.ctxt.stroke(),this.ctxt.closePath(),[e,s]}triangle(e=[0,0],s=50,t=[0,0,0]){var r=Math.tan(numFn.degToRad(60)*Math.PI)*(s/2),i=[];let o=0;e=[e[0]-s/2,e[1]+r/2],this.ctxt.strokeStyle=this.getColor(...t),this.ctxt.beginPath(),this.ctxt.moveTo(e[0],e[1]);for(let t=0;t<3;t++){var[n,h]=numFn.destPosition(e,o,s);this.ctxt.lineTo(n,h),e[0]=n,e[1]=h,o+=-120,i.push([n,h])}return this.ctxt.stroke(),this.ctxt.closePath(),i}square(t=[0,0],e=50,s=[0,0,0]){return this.ctxt.strokeStyle=this.getColor(...s),this.ctxt.beginPath(),this.ctxt.rect(t[0]-e/2,t[1]-e/2,e,e),this.ctxt.stroke(),this.ctxt.closePath(),[[t[0]-e/2,t[1]-e/2],[t[0]+e/2,t[1]-e/2],[t[0]+e/2,t[1]+e/2],[t[0]-e/2,t[1]+e/2]]}circle(t=[0,0],e=50,s=[0,0,0]){this.ctxt.strokeStyle=this.getColor(...s),this.ctxt.beginPath(),this.ctxt.arc(t[0],t[1],e/2,0,numFn.degToRad(360)*Math.PI),this.ctxt.stroke(),this.ctxt.closePath()}path(e,t=[0,0,0]){this.ctxt.strokeStyle=this.getColor(...t),this.ctxt.beginPath();for(let t=0;t<e.length;t++)this.ctxt.lineTo(e[t][0],e[t][1]);this.ctxt.stroke(),this.ctxt.closePath()}}class Share{static isSet=!1;link;notification;constructor(e,t,s){try{if(Share.isSet)throw new Error("Already Set.");Share.isSet=!0,this.link=s,this.notification=t,domFn.selectAll(".share").forEach(t=>{domFn.modClass(t,"bt"),t.textContent=e,t.addEventListener("click",this.listener.bind(this))})}catch(t){error(t)}}async listener(){try{this.link=this.link||location.href,await navigator.clipboard.writeText(this.link)}catch(t){return error(t)}this.notification&&new Notification(this.notification,"success")}}export{Notification,ThemeSetter,SectionsSetter,Copyright,TopButton,Canvas,Share};